# WordCloud GUI 使用说明

## 简介

这是一个基于PyQt5的词云生成器GUI程序，支持实时调整参数和预览词云效果，特别适用于高分屏显示。支持黑夜模式、自定义词频文件导入和生成参数保存。

## 功能特点

- 🎨 **实时预览**: 参数调整后自动更新词云显示
- 🖼️ **多种颜色模式**: 支持默认颜色、灰度、图片颜色
- 📏 **参数调节**: 可调节词数、字体大小、缩放比例等
- 🖱️ **高分屏支持**: 自动适配高分辨率显示器
- 💾 **文件管理**: 支持选择遮罩图片和颜色图片
- 💾 **保存功能**: 支持保存为PNG、JPG格式
- 🌙 **黑夜模式**: 支持白天/黑夜主题切换
- 📊 **词频导入**: 支持自定义词频文件导入（JSON/文本格式）
- 📋 **参数保存**: 自动保存生成参数和文件路径到配置文件
- 🔍 **配置查看**: 提供独立的配置文件查看器

## 安装依赖

```bash
pip install -r requirements_gui.txt
```

## 运行程序

### 主程序
```bash
python wordcloud_gui.py
```

### 配置文件查看器
```bash
python config_viewer.py
```

## 使用说明

### 1. 主题设置
- **主题切换**: 点击左上角的"🌙 黑夜模式"/"☀️ 白天模式"按钮切换主题
- **自动适配**: 主题切换会实时更新所有界面元素

### 2. 文件设置
- **选择词频文件**: 支持JSON格式和文本格式的词频文件
  - JSON格式: `{"词汇": 频率, ...}`
  - 文本格式: `词汇\t频率` 或每行一个词汇
- **选择遮罩图片**: 选择用于定义词云形状的图片
- **选择颜色图片**: 选择用于提取颜色的图片（可选）

### 3. 词云参数
- **最大词数**: 控制词云中显示的最大词汇数量 (100-10000)
- **最大字体**: 最大字体大小 (10-200)
- **最小字体**: 最小字体大小 (1-50)
- **相对缩放**: 控制词频差异的显示程度 (0-1)
- **水平偏好**: 控制词汇水平排列的比例 (0-1)
- **边距**: 词汇之间的间距 (0-50)

### 4. 颜色设置
- **颜色模式**: 
  - 默认颜色: 使用WordCloud默认配色
  - 灰度: 使用随机灰度颜色
  - 图片颜色: 从选择的颜色图片中提取颜色
- **背景颜色**: 白色、黑色或透明

### 5. 操作按钮
- **生成词云**: 根据当前参数生成词云
- **保存词云**: 将生成的词云保存为图片文件，同时保存配置文件
- **实时预览**: 开启/关闭参数变化时的自动预览

### 6. 配置保存功能
当您保存词云图片时，程序会自动生成一个配置文件（`图片名_config.json`），包含：
- **生成时间**: 词云生成的具体时间
- **文件路径**: 所有使用的文件路径（词频、遮罩、颜色图片）
- **词云参数**: 所有调整的参数设置
- **系统信息**: 操作系统、Python版本、WordCloud版本
- **词频统计**: 词汇数量、最高/最低/平均频率

## 配置文件查看器

配置文件查看器（`config_viewer.py`）提供以下功能：
- **加载配置文件**: 直接选择JSON配置文件
- **从图片加载配置**: 选择词云图片，自动查找对应的配置文件
- **配置预览**: 显示配置文件的详细内容
- **图片预览**: 显示对应的词云图片
- **配置导出**: 将配置文件导出到其他位置

## 词频文件格式

### JSON格式示例
```json
{
  "人工智能": 150,
  "机器学习": 120,
  "深度学习": 100,
  "神经网络": 90
}
```

### 文本格式示例
```
健康	200
医疗	180
服务	160
社区	140
```

或者每行一个词汇（频率默认为1）：
```
健康
医疗
服务
社区
```

## 配置文件格式示例

```json
{
  "生成时间": "2024-01-15 14:30:25",
  "词云图片路径": "/path/to/wordcloud.png",
  "词频文件": {
    "路径": "/path/to/frequencies.json",
    "词汇数量": 40
  },
  "遮罩图片": {
    "路径": "/path/to/mask.png",
    "尺寸": [800, 600, 3]
  },
  "颜色图片": {
    "路径": "/path/to/color.png",
    "尺寸": [800, 600, 3]
  },
  "词云参数": {
    "最大词数": 1000,
    "最大字体大小": 30,
    "最小字体大小": 1,
    "相对缩放": 0.1,
    "水平偏好": 0.7,
    "边距": 10,
    "背景颜色": "白色",
    "颜色模式": "图片颜色",
    "字体路径": "/System/Library/Fonts/STHeiti Medium.ttc"
  },
  "系统信息": {
    "操作系统": "Darwin",
    "Python版本": "3.9.7",
    "WordCloud版本": "1.8.1"
  },
  "词频统计": {
    "总词汇数": 40,
    "最高频率": 200,
    "最低频率": 2,
    "平均频率": 45.5
  }
}
```

## 界面布局

```
┌─────────────────┬─────────────────────────────────┐
│ 🌙 黑夜模式      │           预览区域              │
│                 │                                 │
│ 文件设置         │                                 │
│ ├─词频文件       │                                 │
│ ├─遮罩图片       │                                 │
│ └─颜色图片       │                                 │
│                 │                                 │
│ 词云参数         │                                 │
│ ├─最大词数       │                                 │
│ ├─字体大小       │                                 │
│ ├─缩放比例       │                                 │
│ └─其他参数       │                                 │
│                 │                                 │
│ 颜色设置         │                                 │
│ ├─颜色模式       │                                 │
│ └─背景颜色       │                                 │
│                 │                                 │
│ 操作按钮         │                                 │
│ ├─生成词云       │                                 │
│ ├─保存词云       │                                 │
│ └─实时预览       │                                 │
└─────────────────┴─────────────────────────────────┘
```

## 系统要求

- Python 3.7+
- PyQt5 5.15+
- matplotlib 3.3+
- numpy 1.19+
- Pillow 8.0+
- wordcloud 1.8+

## 支持的操作系统

- Windows (自动检测字体路径)
- macOS (自动检测字体路径)
- Linux (自动检测字体路径)

## 注意事项

1. **字体支持**: 程序会自动检测系统中文字体，确保中文显示正常
2. **图片格式**: 支持PNG、JPG、JPEG、BMP、GIF格式
3. **性能优化**: 实时预览有500ms延迟，避免频繁更新影响性能
4. **高分屏**: 程序已优化高分屏显示，支持缩放和清晰显示
5. **词频文件**: 支持UTF-8编码的JSON和文本文件
6. **主题切换**: 主题切换会实时更新所有界面元素，包括控件样式
7. **配置保存**: 每次保存图片时都会自动生成配置文件，方便后续查看和复现

## 故障排除

### 常见问题

1. **无法显示中文**: 检查系统是否安装了中文字体
2. **程序启动失败**: 确保所有依赖包已正确安装
3. **图片加载失败**: 检查图片文件路径和格式
4. **预览不更新**: 确保开启了"实时预览"模式
5. **词频文件加载失败**: 检查文件格式和编码（必须是UTF-8）
6. **主题显示异常**: 重启程序或检查PyQt5版本
7. **配置文件保存失败**: 检查文件路径权限和磁盘空间

### 调试模式

如需调试，可以在命令行中运行：
```bash
python -u wordcloud_gui.py
```

## 示例文件

程序包含以下示例文件：
- `sample_frequencies.json`: JSON格式的词频示例
- `sample_frequencies.txt`: 文本格式的词频示例
- `sample_config.json`: 配置文件格式示例

## 更新日志

- v1.2.0: 添加配置保存和查看功能
- v1.1.0: 添加黑夜模式支持和词频文件导入功能
- v1.0.0: 初始版本，支持基本词云生成和预览功能
- 支持高分屏显示
- 实时参数调整
- 多种颜色模式 